<style>
    #instagram {overflow: hidden;width: 100%;}
    .instagram_item {float: left;width: 20%;padding-right: 1px; padding-bottom: 1px;}
    .instagram_item > a {display: block;width: 100%;padding-top: 100%;position: relative;background: no-repeat center center;background-size: cover;}
    .instagram_item > a:before {content: '';position: absolute;left: 0;right: 0;top: 0;bottom: 0;background: #000000;background: rgba(0, 0, 0, .8);background: -webkit-radial-gradient(center, ellipse cover, rgba(0, 0, 0, .5) 0%, rgba(0, 0, 0, .8) 100%);background: -webkit-radial-gradient(center, ellipse, rgba(0, 0, 0, .5) 0%, rgba(0, 0, 0, .8) 100%);background: radial-gradient(ellipse at center, rgba(0, 0, 0, .5) 0%, rgba(0, 0, 0, .8) 100%);z-index: 1;opacity: 0;-webkit-transition: opacity .55s cubic-bezier(.215, .61, .355, 1);transition: opacity .55s cubic-bezier(.215, .61, .355, 1);}
    .instagram_item p {width: 100%;padding: 19px 57px;position: absolute;left: 0;top: 50%;font-size: 16px;font-weight: 400;text-align: left;color: #fff;transform: translateY(-50%);z-index: 2;opacity: 0;-webkit-transition: opacity .55s cubic-bezier(.215,.61,.355,1);transition: opacity .55s cubic-bezier(.215,.61,.355,1);}
    .instagram_item > a:hover:before {opacity: 1;}
    .instagram_item > a:hover p {opacity: 1;}
</style>

<div id="instagram"></div>

<script>
var token = "<?=$id?>";
$.ajax({
    type: "GET",
    dataType: "jsonp",
    cache: false,
    url: "https://graph.instagram.com/me/media?access_token=" + token + "&fields=id,caption,media_type,media_url,thumbnail_url,permalink",
    success: function(response) {
        if (response.data != undefined && response.data.length > 0) {
            for(i = 0; i < <?=$limit?>; i++){
                if(response.data[i]){
                    var item = response.data[i];
                    var image_url = "";
                    var post = "";

                    if(item.media_type === "VIDEO"){
                        image_url = item.thumbnail_url;
                    }else{
                        image_url = item.media_url;
                    }

                    post += '<div class="instagram_item instagram_item'+i+'">';
                    post += '   <a href="'+ item.permalink +'" target="_blank" rel="noopener noreferrer" style="background-image: url(' + image_url + ');">';
                    post += '   <p>'+ item.caption.substring(0,200) +' ...</p>';
                    post += '   </a>';
                    post += '</div>';

                    $('#instagram').append(post);
                }else{
                    // if no curent item
                    show_fallback('#insta-item-'+i)
                }
            }
        }else{
            // if api error
            show_fallback('.instagram-item')
        }
    },
    error :function(){
        // if http error
        show_fallback('.instagram-item')
    }
});

function show_fallback(el){
    $(el).addClass('loaded fallback');
}
</script>