<section class="content-header">
    <h1>
    <?=$arrInfo['title']?> 관리
    <small><?=$arrInfo['title']?> list</small>
    </h1>

    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active"><?=$arrInfo['title']?> 관리</li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-body">
                    <label style="margin-top:5px;">총 <?=$arrReply['total']?> 건</label>

                    <div class="box-tools pull-right" style="margin-bottom:5px;">

                    <form name="form_search" method="post" action="?tpf=admin/form/list">
                    <input type="hidden" name="tpf" value="admin/form/list">
                    <input type="hidden" name="form_code" value="<?=$this->reqData['form_code']?>">
                        <div class="has-feedback">
                        <span>
                        <input type="text" name="keyword" id="keyword" value="<?=!empty($keyword) ? $keyword : ""?>" class="form-control input-sm" placeholder="검색" onkeypress="if( event.keyCode == 13 ){form_search.submit();}" />
                        <span class="glyphicon glyphicon-search form-control-feedback"></span>
                        </span>
                        </div>
                    </div>

                    <div class="box-tools pull-right" style="margin-bottom:5px;">
                        <div class="has-feedback">
<?php
if(!empty($arrInfo["category_content"]) && $arrInfo["is_category"]=='y'){
	$tm_category = explode("\r\n",$arrInfo["category_content"]);
?>
	                        <select name="category" class="form-control input-sm" style="float:left; width:160px;" onchange="form_search.submit()">
	 			                <option value="">:: 카테고리 선택 ::</option>
<?php
foreach($tm_category as $key => $val) {
	if(trim($val)!=""){
		echo '                  <option value="'.$val.'"'; if(!empty($category) && $category == $val) echo ' selected'; echo '>'.$val.'</option>';
	}
}
?>

	                        </select>
<?php } ?>

<?php
/* 글등록일 검색 요청시 주석 풀면 실행됩니다.
                        <input type="text" name="start_date" id="datepicker1" value="<?=@$this->reqData['start_date']?>"  OnChange="form_search.submit()" readonly="" class="form-control input-sm " style="width:130px; float:left" placeholder="시작일">
                        <span style="padding-top:5px; float:left"> ~ </span>
                        <input type="text" name="end_date" id="datepicker2" value="<?=@$this->reqData['end_date']?>" OnChange="form_search.submit()" readonly="" class="form-control input-sm " style="width:130px; float:left" placeholder="종료일">
*/
?>

<?php
if(!empty($arr_search_select)){
    foreach($arr_search_select as $key => $val) {
        $arrInputExample = explode("\r\n",$val['input_example']);
echo'
                        <select name="'.$key.'" OnChange="form_search.submit()" class="form-control input-sm" style="float:left; width:180px;margin-left:5px; margin-right:5px;">
                            <option value="">전체</option>

';
        if(!empty($arrInputExample)){
            foreach($arrInputExample as $key2 => $val2) {
        echo'
                            <option value="'.$val2.'" '; if(!empty($this->reqData[$key]) && $this->reqData[$key] == ''.$val2.'') echo ' selected'; echo '>'.$val2.'</option>
        ';
            }
        }echo'

                        </select>
';
    }
}
?>




                        <select name="field" class="form-control input-sm" style="float:left; width:130px;">
<?php
foreach($arrSearch as $key => $val) {
    echo '      <option value="'.$key.'"'; if(!empty($field) && $field == $key) echo ' selected'; echo '>'.$val.'</option>';
}
?>
                        </select>



                        </div>
                    </form>

                    </div>
                    <table class="table table-bordered table-hover">
                    <form name="form_list" method="post" action="?tpf=admin/form/process">
		            <input type="hidden" name="mode" id="mode">
		            <input type="hidden" name="form_code" value="<?=$form_code?>">
                    <thead>
                    <tr>
                        <td style="width:30px;"><input type="checkbox" name="select_all" onclick=selectAllCheckBox('form_list'); /></td>
                        <td style="width:60px;">NO</td>
<?php
$arrIsShow = array();
if (!empty($arrItem)) {
    foreach($arrItem as $key => $val) {
        if ($val['is_show'] == 'y') {
            $arrIsShow[] = $val['code'];
            echo '      <td>'.$val['label'].'</td>';
        }
    }
}
if($form_code == 5) {
    echo '              <td>이름</td>
                        <td>휴대폰</td>
                        <td>이메일</td>';
}
?>
                        <td style="width:120px;">등록일</td>
<?php
if(!empty($arrReply['list'])) {
    foreach($arrReply['list'] as $key => $val) {
        if($val['is_reply'] == 'y') {
            echo '      <td style="width:80px;">답장</td>
                        <!-- <td>답장 내용</td> -->
                        <td>답장 발신일</td>';
        }
        if($val['is_question'] == 'y') {
            echo '      <td>답변 만족도 <br>조사 결과</td>';
        }
        if($val['is_category'] == 'y') {
            echo '      <td>카테고리 항목</td>';
        }
        break;
    }
}
?>
                        <td style="width:80px;">
                            <i onclick="<?=$onclick_change_down?>" class="fa fa-fw fa-arrow-circle-down cp" style="cursor:pointer;"></i>
                            <i onclick="<?=$onclick_change_up?>" class="fa fa-fw fa-arrow-circle-up cp" style="cursor:pointer;"></i>
                        </td>
                        <td style="width:120px;">명령</td>
                    </tr>
                    </thead>
<?php
// 리스트
if (!empty($arrReply['list'])) {
    foreach($arrReply['list'] as $key => $val) {
        echo '      <tr>
                        <td><input type="checkbox" name="list[]" value="'.$val['code'].'" /></td>
                        <td>'.$arrReply['start_number'].'</td>';
        foreach($arrItem as $key2 => $val2) {
            if (in_array($val2['code'], $arrIsShow)) {
                switch($val2['input_type']) {
                    case "file":
                        $arrUploadFile = @$arrFile[$val['code']][$val2['code']];
                        echo '  <td>';
                        if($arrUploadFile['orig_name'] != '') {
                            if (checkImage($arrUploadFile['file_ext'])) {   // 이미지 파일일때
                                echo '<a href="#none" onclick="location.replace(\'/index.php?tpf=common/save_as&file_path='.$arrUploadFile['file_path'].'&file_name='.$arrUploadFile['file_name'].'&orig_name='.urlencode($arrUploadFile['orig_name']).'\');"><img src="'.$arrUploadFile['url_tn'].'" style="width:80px;"></a>';
                            }
                            else {
                                echo '<a href="#none" onclick="location.replace(\'/index.php?tpf=common/save_as&file_path='.$arrUploadFile['file_path'].'&file_name='.$arrUploadFile['file_name'].'&orig_name='.urlencode($arrUploadFile['orig_name']).'\');"><i class="fa fa-file-text"></i> '.$arrUploadFile['orig_name'].'</a>';
                            }
                        }
                        echo '  </td>';
                    break;

                    default:
                        echo '  <td style="text-align:left;">'.nl2br(@$val['arrContent'][$val2['code']]).'</td>';
                    break;
                }
            }
        }
        if($form_code == 5) {
            if(!empty($arrMemberInfo['list'])) {
                foreach($arrMemberInfo['list'] as $key2 => $val2) {
                    if($val['member_code'] == $val2['code']) {
                        echo '
                        <td>'.$val2['name'].'</td>
                        <td>'.$val2['mobile'].'</td>
                        <td>'.$val2['email'].'</td>';
                    }
                }
            }
            else {
                echo '  <td></td>
                        <td></td>
                        <td></td>';
            }
        }
        echo '          <td>'.$val['reg_date'].'</td>';
        if($val['is_reply'] == 'y') {
            echo '      <td>'; if($val['reply_date']) {echo '답장 완료';} else {echo '답장 전';} echo '</td>
                        <!-- <td style="text-align: left;">'.nl2br(@$val['reply']).'</td> -->
                        <td style="width:120px;">'.$val['reply_date'].'</td>';
        }
        if($val['is_question'] == 'y') {
            echo '      <td style="width:150px;">';
            $arrQuestionContent = explode("\n", $val['question_content']);
            if(!empty($val['reply_grade'])) {
                $arrQuestionReply = unserialize($val['reply_grade']);
                foreach($arrQuestionReply as $key2 => $val2) {
                    echo '  <li style="list-style:none">'.$arrQuestionContent[$key2-1].':'.$val2.'점</li>';
                }
            }
            echo '      </td>';
        }
        if($val['is_category'] == 'y') {
            echo '      <td>'.@$val['category'].'</td>';
        }
        echo '          <td><input type="radio" name="order_code" value="'.$val['order_code'].'"'; if($val['order_code'] == @$order_code) { echo ' checked';} echo' /></td>
                        <td>
                            <button type="button" onclick="onclickUpdate('.$val['code'].');" class="btn btn-primary btn-xs">수정하기</button>';
        if(!empty($arrInfo)) {
            if($arrInfo['is_reply'] == 'y') {
                echo '      <button type="button" onclick="onclickSendMail('.$val['code'].');" class="btn btn-primary btn-xs">답장</button>';
            }
        }
        echo '          </td>
                    </tr>';
                    $arrReply['start_number']--;
    }
}
else {
        echo '      <tr><td colspan="20"><br>등록된 자료가 없습니다.<br><br></td></tr>';
}
?>
                    </form>
                    </table>
                    <br>

                    <button type="button" onclick="selectDelete('deleReply');" class="btn btn-danger btn-sm"><i class="fa fa-minus-square"></i> 선택삭제</button>
                    <button type="button" onclick="onclickInsert();" class="btn btn-primary btn-sm"><i class="fa fa-plus-square"></i> 등록</button>
                    <button type="button" onclick="onclickCopyContent();" class="btn btn-warning btn-sm" style="margin-left:20px;"><i class="fa fa-copy"></i> 리스트 복사</button>
                    <button type="button" onclick="uploadExcel();" class="btn btn-warning btn-sm"><i class="fa fa-file-excel-o"></i> Excel 업로드</button>
                    <button type="button" onclick="downloadExcel();" class="btn btn-warning btn-sm"><i class="fa fa-file-excel-o"></i> Excel 다운로드</button>
                    <form name="form_download" method="post" action="?tpf=admin/form/process">
                        <input type="hidden" name="mode" value="downloadExcel">
                        <input type="hidden" name="form_code" value="<?=$form_code?>">
                        <input type="hidden" name="search_data">
                    </form>

                    <div style="text-align:right;">
                        <?php echo $arrReply['page'];?>
                    </div>
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div><!-- /.col-xs-12 -->
    </div><!-- /.row -->
</section>

<div class="modal fade" id="modalContent" tabindex="-2" role="dialog" aria-labelledby="myModal" aria-hidden="true">
    <div class="modal-dialog" style="width:800px;">
        <div class="modal-content">
            <form name="formRegister" id="formRegister" method="post" onsubmit="return false;" action="?tpf=admin/form/process" enctype="multipart/form-data">
            <input type="hidden" name="mode" id="mode" value="insertReply">
            <input type="hidden" name="code" id="code">
            <input type="hidden" name="form_code" id="form_code">
            <input type="hidden" name="locale" id="locale">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabelPortfolio">정보 등록</h4>
            </div>
            <div class="modal-body">

            <h4><p class="text-light-blue"><i class="fa fa-fw fa-info-circle"></i> 정보 등록</p></h4>
                <table class="table table-bordered">
<?php
if(!empty($arrInfo)) {
    if($arrInfo['is_category'] == "y") {
        echo '      <tr>
                        <td class="menu">카테고리 <span class="text-light-blue"><i class="fa fa-check"></i></span></td>
                        <td align="left">
                            <select name="category" class="form-control input-sm">
                                <option value="">선택하세요</option>';
        $arrCategory = preg_split("/\n/", $arrInfo['category_content']);
        if(count($arrCategory) > 0) {
            foreach($arrCategory as $key => $val) {
                echo '          <option value="'.trim($val).'">'.trim($val).'</option>';
            }
        }
        echo '              </select>
                        </td>
                    </tr>';
    }
}
if (!empty($arrItem)) {
    foreach($arrItem as $key => $val) {
        echo '      <tr>
                        <td class="menu">'.$val['label']; if($val['is_require'] == 'y') { echo ' <span class="text-light-blue"><i class="fa fa-check"></i></span>';} echo '</td>
                        <td align="left">';
        switch($val['input_type']) {
            case "text":
            case "tel":
            case "email":
                echo '  <input type="text" name="data'.$val['code'].'" placeholder="'.$val['placeholder'].'" class="form-control input-sm" />';
            break;

            case "textarea":
                echo '  <textarea name="data'.$val['code'].'" placeholder="'.$val['placeholder'].'" class="form-control input-sm" style="padding:5px; line-height:20px; width:100%; height:200px;"></textarea>';
            break;

            case "webeditor":
                echo '  <textarea id="content'.$val['code'].'" name="data'.$val['code'].'" placeholder="'.$val['placeholder'].'" class="form-control input-sm" style="padding:5px; line-height:20px; width:100%; height:200px;"></textarea>';
            break;

            case "select":
                $arrInputExample = preg_split('/\n/',$val['input_example']);
                echo '  <p>
                        <select name="data'.$val['code'].'" class="form-control input-sm">
                        <option value="">선택하세요</option>';
                if (count($arrInputExample) > 0) {
                    foreach($arrInputExample as $key2 => $val2) {
                        echo '<option value="'.trim($val2).'">'.trim($val2).'</option>';
                    }
                }
                echo '  </select></p>';
            break;

            case "radio":
                $arrInputExample = preg_split('/\n/',$val['input_example']);
                if (count($arrInputExample) > 0) {
                    foreach($arrInputExample as $key2 => $val2) {
                        $key2 = $key2+1;
                        echo '
                        <p>
                        <input type="radio" id="label'.$val['code'].'_'.$key2.'" name="data'.$val['code'].'" value="'.trim($val2).'" style="font-size:0.8125rem;" />
                        <label for="label'.$val['code'].'_'.$key2.'">'.trim($val2).'</label></p>';
                    }
                }
            break;

            case "checkbox":
                $arrInputExample = preg_split('/\n/',$val['input_example']);
                if (count($arrInputExample) > 0) {
                    foreach($arrInputExample as $key2 => $val2) {
                        $key2 = $key2+1;
                        echo '
                        <p>
                        <input type="checkbox" id="label'.$val['code'].'_'.$key2.'" name="data'.$val['code'].'[]" value="'.trim($val2).'" style="font-size:0.8125rem;" />
                        <label for="label'.$val['code'].'_'.$key2.'">'.trim($val2).'</label></p>';
                    }
                }
            break;

            case "date":
                echo '  <input type="text" id="datepicker'.$val['code'].'" name="data'.$val['code'].'" readonly style="width:100px;" /> <i class="fa fa-calendar"></i>';
            break;

            case "file":
                echo '  <input type="file" id="data'.$val['code'].'" name="file[]" style="width:80%; float:left;" />
                        <span id="displayFile'.$val['code'].'" style="display:none;"></span>';
            break;
        }
        echo '          </td>';
    }
}
if(!empty($arrReply['list'])) {
    foreach($arrReply['list'] as $key => $val) {
        if($val['is_reply'] == 'y') {
            echo '  <tr>
                        <td class="menu">답변 제목</td>
                        <td align="left">
                            <span id="reply_Title"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="menu">답변 내용</td>
                        <td align="left">
                            <span id="reply_Content"></span>
                        </td>
                    </tr>';
        }
        break;
    }
}
?>
                </table>

            </div>
            <div class="modal-footer">
                <button type="button" onclick="registerForm();" class="btn btn-primary">저장하기</button>
            </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalCopyList" tabindex="-2" role="dialog" aria-labelledby="myModal" aria-hidden="true">
    <div class="modal-dialog" style="width:400px;">
        <div class="modal-content">
            <form name="formCopyContent" method="post" action="?tpf=admin/form/process">
                <input type="hidden" name="mode" id="mode" value="copyContent">
                <input type="hidden" name="form_code" value="<?=$form_code?>">
                <input type="hidden" name="code" id="code">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <h4 class="modal-title" id="myModalLabelPortfolio">리스트 복사</h4>
                </div>
                <div class="modal-body">
                    <h4><p class="text-light-blue"><i class="fa fa-fw fa-info-circle"></i> 리스트 <span id="board_sub_title">복사</span></p></h4>
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <td class="menu">폼메일 선택</td>
                                <td align="left">
                                    <select name="to_form_code"class="form-control input-sm">
                                        <option value="">선택</option>
<?php
if(!empty($arrCopyList)) {
    for($i=0;$i<$arrCopyList['total'];$i++) {
        $copyTarget = $arrCopyList['list'][$i]['code'];
        $targetTitle = $arrCopyList['list'][$i]['title'];
        echo '                          <option value="'.$copyTarget.'">'.$targetTitle.'</option>';
    }
}
?>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="registerCopyContent()" class="btn btn-primary">확인</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalContentReply" tabindex="-2" role="dialog" aria-labelledby="myModal" aria-hidden="true">
    <div class="modal-dialog" style="width:800px;">
        <div class="modal-content">
            <form name="formReply" method="post" onsubmit="return false;" action="?tpf=admin/form/process">
            <input type="hidden" name="mode" id="mode" value="insertReplyMail">
            <input type="hidden" name="form_code" value="<?=$form_code?>">
            <input type="hidden" name="code">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabelPortfolio">답장</h4>
            </div>
            <div class="modal-body">

            <h4><p class="text-light-blue"><i class="fa fa-fw fa-info-circle"></i> 답장</p></h4>
            <table class="table table-bordered">
<?php
/*
if (!empty($arrItem)) {
    foreach($arrItem as $key => $val) {
        switch($val['input_type']) {
            case "email":
                echo '
                <tr>
                    <td class="menu">받는사람 메일</td>
                    <td align="left"><input type="text" data="data'.$val['code'].'" class="form-control input-sm" name="receiver_email[]" readonly/></td>
                </tr>';
            break;
        }
    }
}
*/
if (!empty($arrItem)) {
    foreach($arrItem as $key => $val) {
		
        if($val['input_type']=="email" || $val['check_type']=="email") {

                echo '
                <tr>
                    <td class="menu">받는사람 메일</td>
                    <td align="left"><input type="text" data="data'.$val['code'].'" class="form-control input-sm" name="receiver_email[]" readonly/></td>
                </tr>';

        }
    }
}

?>
                <tr>
                    <td class="menu">참조 <span class="text-light-blue"></span></td>
                    <td align="left"><input type="text" class="form-control input-sm" name="receiver_email2" placeholder="admin@<?=_RESOURCE_URL?>, admin2@<?=_RESOURCE_URL?>"></td>
                </tr>
                <tr>
                    <td class="menu">제목 <span class="text-light-blue"><i class="fa fa-check"></i></span></td>
                    <td align="left"><input type="text" class="form-control input-sm" id="title" name="title" ></td>
                </tr>
<?php
if(!empty($arrItem)) {
    foreach($arrItem as $key => $val) {
        switch($val['input_type']) {
            case "textarea":
            case "webeditor":
                echo '
                <tr>
                    <td class="menu">내용 <span class="text-light-blue"><i class="fa fa-check"></i></span></td>
                    <td align="left"><textarea data="data'.$val['code'].'" name="content" id="replyContent" class="form-control input-sm" style="padding:5px; line-height:20px; width:100%; height:200px;"></textarea></td>
                </tr>';
            break;
        }
    }
}
// 답변 만족도 조사 사용시
if(!empty($arrReply['list'])) {
    foreach($arrReply['list'] as $key => $val) {
        if($val['is_question'] == 'y') {
            echo '
            <tr style="display:none">
                <td class="menu">답변 만족도 조사 한다</td>
                <td align="left"><input type="checkbox" name="is_question" value="y" checked></td>
            </tr>';
        }
        else {
            echo '
            <tr style="display:none">
                <td class="menu">답변 만족도 조사 안한다</td>
                <td align="left"><input type="checkbox" name="is_question" value="n" checked></td>
            </tr>';
        }
        break;
    }
}
?>
            </table>

            </div>
            <div class="modal-footer">
            <button type="button" onclick="registerSendMail();" class="btn btn-primary">발신하기</button>
            </div>
            </form>
        </div>
    </div>
</div>

<form name="formFileDelete" method="post" action="?tpf=admin/form/process">
    <input type="hidden" name="mode" id="mode" value="deleteFile">
    <input type="hidden" name="code" id="code">
</form>

<form name="formDeleteAll" method="post" action="?tpf=admin/form/process">
    <input type="hidden" name="mode" id="mode" value="deleteAll">
    <input type="hidden" name="form_code" value="<?=$form_code?>">
</form>

<div class="modal fade" id="modalUploadExcel" tabindex="-2" role="dialog" aria-labelledby="myModal" aria-hidden="true">
    <div class="modal-dialog" style="width:600px;">
        <div class="modal-content">
            <form name="formUploadExcel" id="formUploadExcel" method="post" onsubmit="return false;" action="?tpf=admin/form/process" enctype="multipart/form-data">
            <input type="hidden" name="mode" id="mode" value="uploadExcel">
            <input type="hidden" name="form_code" value="<?=$form_code?>">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabelPortfolio">엑셀 업로드</h4>
            </div>
            <div class="modal-body">

            <h4><p class="text-light-blue"><i class="fa fa-fw fa-info-circle"></i> 엑셀 업로드</p></h4>
            ※ 엑셀 자료의 첫 행은 입력되지 않습니다.<br>
            ※ 파일 확장자는 Excel 통합 문서(*.xls) 만 가능합니다.<br><br>
            <table class="table table-bordered">
            <tr>
                <td class="menu">파일</td>
                <td align="left">
                <input type="file" id="excelFile" name="file" />
                </td>
            </tr>
            </table>

            </div>
            <div class="modal-footer">
            <button type="button" onclick="registerUploadExcel();" class="btn btn-primary">저장하기</button>
            </div>
            </form>
        </div>
    </div>
</div>

<script src="//<?=_RESOURCE_URL?>/resource/js/ckeditor4.7.2/ckeditor.js"></script>